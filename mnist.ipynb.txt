{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Recognizing hand-written digits with neural networks\n",
    "\n",
    "**Neural network Python libraries**\n",
    "- *Keras*: High level library based on Tensorflow (or others) that is easy to use and flexible enough for most standard users. It has a great documentation and online support. \n",
    "- *Tensorflow*: Google's neural network library. Most widely used in ML research. Flexible and powerful but also (unnecessarily?) complicated.\n",
    "- *Pytorch*: The newcomer developed by Facebook. Flexible like Tensorflow but with a nicer, more Pythonic API.\n",
    "\n",
    "In this notebook we will tackle a classification task, recognizing hand-written digits of the famous MNIST dataset."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "%matplotlib inline\n",
    "import numpy as np\n",
    "from tensorflow import keras\n",
    "import matplotlib.pyplot as plt\n",
    "from sklearn.model_selection import train_test_split\n",
    "from tensorflow.keras.layers import *\n",
    "from tensorflow.keras.optimizers import SGD, Adam\n",
    "from tensorflow.keras.models import Sequential\n",
    "from tensorflow.keras.utils import to_categorical"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## MNIST - Preparing and exploring the data\n",
    "\n",
    "Keras has a handy function to download the entire MNIST dataset which consists of 60,000 training images and 10000 test images."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Downloading data from https://storage.googleapis.com/tensorflow/tf-keras-datasets/mnist.npz\n",
      "11490434/11490434 [==============================] - 2s 0us/step\n"
     ]
    }
   ],
   "source": [
    "(x_trn, y_trn), (x_test, y_test) = keras.datasets.mnist.load_data()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "((60000, 28, 28), (60000,), (10000, 28, 28), (10000,))"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "x_trn.shape, y_trn.shape, x_test.shape, y_test.shape"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "**STOP!** What are training, validation and test sets?\n",
    "\n",
    "- Training set: Data used to optimize the machine learning algorithm\n",
    "- Validation set: Data used to independently verify the skill of the algorithm\n",
    "- Test set: Another independent set used for *final* verification.\n",
    "\n",
    "Let's make a validation set."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Set a random seed to make train/valid split reproducible\n",
    "np.random.seed(42)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "x_trn, x_val, y_trn, y_val = train_test_split(x_trn, y_trn, test_size=0.2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "((48000, 28, 28), (12000, 28, 28))"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "x_trn.shape, x_val.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "def plots(xs, ys):\n",
    "    nfigs = xs.shape[0]; ncols = min(3, nfigs); nrows = int(np.floor(nfigs / ncols))\n",
    "    fig, axs = plt.subplots(nrows, ncols, figsize=(3*ncols, 3*nrows))\n",
    "    for i, ax in enumerate(axs.flat):\n",
    "        ax.imshow(xs[i], cmap='gray')\n",
    "        ax.set_title(str(ys[i]))\n",
    "        ax.set_xticks([]); ax.set_yticks([])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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2ZgxY5Jrm5qaolnqbF5xxRXJfVOfE4quO/bYYwvtGUII//rXv6LZTTfdlFw7e/bsaPbRRx8VngmqTWtXpra0tBTat7GxMZq9//77hfbsqLyJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJlfcLYPWrnI66qijotmf//znaLbWWmtFs7/85S/JZ6bWPvbYY9HsoosuSu778MMPR7OGhobkWugoTjvttGh24oknRrP58+cn902t7d+/fzRLXZcZQghbbLFFNCuXy9EsdZ3cwoULk8/ccMMNo1ldXV00O+uss5L7XnjhhdHs9NNPj2Yff/xxcl+ohDPPPLPSI7AcvIkGAIBMSjQAAGRSogEAIJMSDQAAmZRoAADIpEQDAEAmJRoAADK5J/ozq666ajQ78sgjk2s7dYp/LfL+++9Hs/feey+abb755slnpjQ1NUWzDz/8sPC+0JHssssu0eyEE06IZosWLYpmkydPTj5zypQp0Wz11VdPrk35+9//Hs3uuuuuaHb11VdHszfffDP5zG233Taa7bDDDtHsoIMOSu774x//OJqVSqVo9rOf/Syaffrpp8lnQntJnZNUt2hNc3NzNHvppZcK78vneRMNAACZlGgAAMikRAMAQCYlGgAAMinRAACQSYkGAIBMpXK5XC6ycPHixaFnz55tPU/FjBw5MprdeuutybUNDQ3RbJtttolm8+fPb3UuaktjY2Po0aNHpceIqrVznbLeeusl86eeeiqa9enTJ5rNmDEjmn35y19OPnPttdeOZvfcc080O+ecc5L73nvvvcl8ZTJ9+vRotueee0az0aNHR7OJEycu10zONUX99a9/jWbDhg1Lrm1paYlmr776ajQbNGhQ64OxTOfam2gAAMikRAMAQCYlGgAAMinRAACQSYkGAIBMSjQAAGTqXOkBqsVee+1VeG3qWqrHHnus0J6zZ89O5ueee240S11n9dFHHxWaB1ZG3bp1i2a//OUvk2tT19hdd9110ezdd9+NZnvssUfymXvvvXc0S13t9vHHHyf3rSWHHHJINHvppZei2YQJE6LZ8l5xBym9evWKZquvvnq7PDN19S5tx5toAADIpEQDAEAmJRoAADIp0QAAkEmJBgCATEo0AABkcsXdZ95+++3Cazt3jv8y9u/fv9Cera274447otnDDz9caF0IIZx33nnpwWAlsvPOO0ezAw88MLl24cKF0eyCCy6IZv369YtmJ5xwQvKZ//znP6NZR7rGLmXBggXRLPVrNG/evPYYB1p12GGHRbNvfOMb7fLMY445pl325fO8iQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMrkn+jMXXnhhNBsxYkRybXNzczR7+umnC82z1157JfMvfelL0exrX/taoSyEEAYPHhzNRo0aFc0++eST5L5QCcOHD49mjY2NybV77713NHvuueei2SuvvBLNdtttt+QzW5uJEC666KJo1rdv32g2evTo9hgHKmbixInRbO7cuStwko7Lm2gAAMikRAMAQCYlGgAAMinRAACQSYkGAIBMSjQAAGRyxd1nli5dGs223377FTjJ/3XiiScm82233TaaTZ8+PZqtueaayX3333//aPbss89Gsy222CKaffrpp8lnwvJYbbXVolnqnMyfPz+570MPPVRong8//DCa3XfffYX27EgGDhyYzL/3ve9Fs0mTJkWzW2+9tehIkLT66qsn80GDBkWzTp3i7zJTWQghvPTSS9Hs/fffT66lbXgTDQAAmZRoAADIpEQDAEAmJRoAADIp0QAAkEmJBgCATK64W0k98cQT0Sx1Jd8ll1yS3HfYsGHRbJNNNolmp59+ejSbMGFC8pmwPIYOHRrNvvrVr0azyZMnt8c4LINNN900mt1///3Jtd26dYtmM2bMiGblcrn1waCAM844I5kfffTR0aylpaXwc/2ZrjxvogEAIJMSDQAAmZRoAADIpEQDAEAmJRoAADIp0QAAkEmJBgCATO6JrkGzZs2KZnvvvXdy7YUXXhjNTjrppGh2/PHHR7Nrr702+cxXX301mUPKHnvsEc1S96g+9NBD7TFOh7Hqqqsm88GDB0ez0047LZrV1dUl991ss82i2euvv55cC0X17ds3mu27777t8szm5uZk3tjY2C7PZdl5Ew0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgEyuuPvMRhttFM1q6Qq2lpaWZH7GGWdEs+HDh0ezTTbZJJrV19cnn1lLv76seD/60Y+i2aJFi6LZgw8+2A7T1JZ11lknmk2aNCm5duTIkdHsgQceiGbDhg1L7usaOyohdS1j//792+WZY8aMSeatXR9L+/MmGgAAMinRAACQSYkGAIBMSjQAAGRSogEAIJMSDQAAmVxx95lnnnkmmu28887JtU888URbj1MxTU1N0ezSSy+NZpdffnl7jAPL5YMPPohmHelqxVVWWSWanXzyydFsl112iWZDhw5NPvO+++6LZgceeGA0e/fdd5P7QnvZdttto1nqysb2cuWVV67wZ5LHm2gAAMikRAMAQCYlGgAAMinRAACQSYkGAIBMSjQAAGRyxd1nunbtGs06d/bLFEIIH330UaVHgCxrrrlmNNtjjz2Sa2fMmNHW4yyXHXfcMZq19jlq/Pjx0Wz33XePZkuXLo1mP/nJT5LPvO6666KZa+yoRo8//ng0a2lpWYGTsLLwJhoAADIp0QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyOQC5M+USqVo1q1btxU4SWVtuOGG0Wzs2LErcBJYNrNmzYpmG2ywQTQ766yzkvtW4n744447LpoNHTo0mq266qrJfVN33E6ZMiWaXXDBBdHsySefTD4TVjapc9Je90RPnDixXfZlxfAmGgAAMinRAACQSYkGAIBMSjQAAGRSogEAIJMSDQAAmVxx95k333wzmv3ud79Lrr388suj2VVXXRXNFi5c2PpgEakrrYYMGRLNttxyy+S+P/rRj6LZ+uuvH82am5uj2aJFi5LPhOWx2267RbMZM2ZEs+233z657+233154pvbw6quvRrOnnnoqufacc86JZs8880zhmYDlM3Xq1EqPwHLwJhoAADIp0QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJlccfeZPfbYI5pNnz49ufbCCy+MZieeeGI0++CDD1qdK6ZTp/jXPxtssEHhfVM++eSTaDZq1Kho5got2tMbb7wRzb7+9a9Hs9Sf2RBC2HXXXaNZt27dolnquszWpM7K9ddfH83mz59f+JkAFONNNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMinRAACQqVQul8tFFi5evDj07NmzreepShtuuGEy/+lPfxrNUnfNbrLJJoVnKmrmzJnJfPbs2dHsggsuiGaPPvpo0ZE6lMbGxtCjR49KjxHVkc51a1ZdddVolrqn/cMPP2yPcahiznVt+PTTT6NZS0tL4X1vu+22aPaDH/wgmr377ruFn8nyW5Zz7U00AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyda70ACuDf/3r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hnkTDQAAmZRoAADIpEQDAEAmJRoAADIp0QAAkEmJBgCATEo0AABkck80n/OlL30pmk2ePDmafeELX4hmrd0Dvd9++0WzBQsWRLM5c+Yk94Vasu6660azTp3S70M++uijaLbeeutFs5EjR0Yz90QDHZ030QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyOSKuw4mdRVdCCG8+uqrhfZtamqKZoMHD06unTVrVqFnQkcyevToaNa7d+/k2nnz5kWz1s4n0H569uwZzTbddNPk2oMOOiiaHXHEEdGsoaEhmk2fPj35zJQbbrghmqU+B4Ww8l5Z6000AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyueKuBq255prR7IorrkiuLZfL0eyVV16JZkcddVQ0c4UdALWqc+d0lUpdG1dfXx/NBg4cWHimlNS1eoMGDSq870knnRTNGhsbk2sPPPDAaDZjxozCM7U3b6IBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgEzuiV5JdenSJZr98pe/jGZDhw5N7vv+++9Hsx/+8IfR7MEHH0zuCwC16Iwzzkjmu+22W6F9P/nkk2T+8MMPR7O77747mr3++uvRbNq0aclnpjrEJZdcEs169+6d3PfQQw+NZu6JBgCAGqJEAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZHLF3Urq8MMPj2bf//73o1nqCrsQQthvv/2iWerKHADoiG6++eZk3tjYGM1efPHFaNbU1JTc9957700PVsDw4cOT+YEHHhjNUlfvpv47QwjhlltuSQ9WpbyJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJlfcVakDDjggmV9xxRWF9v3FL36RzGfMmFFoX2D59e/fP5r99Kc/LbzvE088UXgtkPb0008vV94eunXrFs023XTTaHbaaacl991xxx2j2SeffBLNrrzyyuS+t912WzKvVt5EAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkyvuKmiHHXaIZtdcc01ybVNTUzR78skno9m1117b+mBARZRKpWjWpUuXwvtOmjSp8FqgMnbeeedkvvfee0ezb33rW9Fs0KBBhWd6/vnno9nll18eze68887Cz6xm3kQDAEAmJRoAADIp0QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJncE93O1l577Wg2ZcqUaLbaaqsl933mmWei2fDhw6PZBx98kNwXAFZWqbvWQwhh1VVXjWaDBw+OZql/16E1Q4YMiWapO5sHDhxY+JktLS3R7NZbby2UtZYvXry4lalqjzfRAACQSYkGAIBMSjQAAGRSogEAIJMSDQAAmZRoAADI5Iq7NlBfXx/N/vCHPxRa97e//S35zO9///vRLHWNXbdu3ZL7/td//Vcyj3nyySej2QsvvFBoT+hoLrrookLr3n777eXKoVaccMIJyfziiy9eQZMsv/nz5yfzvn37RrP7778/mh1++OHRrLGxsfXB+DdvogEAIJMSDQAAmZRoAADIpEQDAEAmJRoAADIp0QAAkMkVd8sgdRVdCCGMHz8+mu26667R7MUXX4xmqSvsQgihT58+0eySSy6JZkWvsGvN7Nmzo9ngwYOTa9977722HgdWSnV1dYXW3X333cn8iSeeKLQvrGxOO+20ZF4qlaJZuVwu9MyWlpZkftVVV0WzP/3pT9EsdV1tCCHcc8890SzVPb72ta9Fs2nTpiWfyed5Ew0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZHJP9DJo7W7lo48+Opo1NzdHs3HjxkWzpUuXJp957rnnRrPhw4dHs5kzZyb3ve6666LZd77znWi21VZbFZonhBCuvfbaZA6knXzyyZUeAarCRhttlMxT90ivu+660eyxxx6LZjfeeGPymfPnz0/mMZtttlkynzt3bjRbZZVVotn6669faB7+N2+iAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMinRAACQyRV3n+nTp080O/PMMwvve/7550ezJ598Mpo99dRTyX3XWWedaLbrrrtGs8cffzy57wcffBDNUlfcde4c/6O0xhprJJ8JHcWIESOS+U477bSCJoHa1NjYmMzHjh27giZZfr/85S+TeepKvkcffTSaTZw4sfBMfJ430QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyOSKu89svPHG0ayuri659o9//GM0u/vuuwut+/jjj5PPPOyww6LZAw88EM26detWeN+vfOUr0WzhwoXRbNGiRclnQkfR2vnr2rXrCpoEWFG6dOkSzS6//PJo9q1vfavwMydMmFB4LcvOm2gAAMikRAMAQCYlGgAAMinRAACQSYkGAIBMSjQAAGRyxd1nNtxww2hWKpWSa3faaado9sgjj0SzHXbYIZo99NBDyWdOmTIlmccceeSRyfzSSy+NZqlfh1//+tfR7MYbb2x1LugIWvtcAh3FzjvvnMxTfwd++umnbT1Ou/r2t78dzVr7Ozkl9WvUWoegbXgTDQAAmZRoAADIpEQDAEAmJRoAADIp0QAAkEmJBgCATEo0AABkck/0Z55++ulo9tJLLyXXbrrpptHsoosuimbNzc3R7Pnnn08+8w9/+EM023333aNZnz59kvsuXLgwmv3oRz+KZjfddFNyXyCEcrlc6RFghbn55puj2d57751cO3Xq1GiW+vu6vay77rrRLHUPdAgh9OrVq9Azx4wZk8wvv/zyaPbhhx8WeiZ5vIkGAIBMSjQAAGRSogEAIJMSDQAAmZRoAADIpEQDAEAmV9x95rnnnotmxx9/fHLtbbfdFs26du0azbp37x7Njj766OQzS6VSNEtdo/X73/8+ue/EiROj2WOPPZZcC6Slzi3UmmuvvTaaDRo0KLl2v/32i2b77rtv4ZmK/t2Z0tq6hoaGaHbZZZdFs1/96lfJfVtaWtKD0e68iQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCZX3C2Du+++O5nvs88+0eyQQw6JZrvvvns0e+2115LPTOVTpkyJZvfdd19y36ampmQOFFf0Cq3W7Lbbbsn8xhtvbJfnQkrq+tfW/i5K/b261VZbFZyofbR2vmbPnh3NFi9eHM1cYVf9vIkGAIBMSjQAAGRSogEAIJMSDQAAmZRoAADIpEQDAEAmJRoAADKVygUvLl28eHHo2bNnW88DNa2xsTH06NGj0mNEOdftq1evXsn89ttvj2Y77rhjNLv00kuT+5500knJnOXjXEPtWZZz7U00AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyda70AAAdxaJFi5L52WefHc1Gjx4dzc4777yiIwFQkDfRAACQSYkGAIBMSjQAAGRSogEAIJMSDQAAmZRoAADI5Io7gCoxbdq0QhkAK5430QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMinRAACQSYkGAIBMSjQAAGRSogEAIFPhEl0ul9tyDugQqv3cVPt8UI2q/dxU+3xQjZbl3BQu0U1NTUWXQodV7eem2ueDalTt56ba54NqtCznplQu+CVqS0tLaGhoCHV1daFUKhXZAjqMcrkcmpqaQn19fejUqXp/isq5hmXnXEPtyTnXhUs0AAB0VNX7pTMAAFQpJRoAADIp0QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYlukY89dRTYZ999gn19fWhe/fuYeDAgeHMM88M77//fqVHAwpyrqH2NDU1hbFjx4Y999wz9O3bN5RKpTBhwoRKj0UBSnQNeOGFF8LXvva18Prrr4df//rXYerUqeE73/lOOPPMM8PBBx9c6fGAApxrqE0LFiwIkyZNCh9++GHYZ599Kj0Oy6FzpQdg+V1//fVh6dKl4ZZbbgkbbrhhCCGE3XbbLcydOzdMmjQpvPfee2HNNdes8JRADucaatP6668f3nvvvVAqlcK7774bJk+eXOmRKEiJrgGrrrpqCCGEnj17fu7jvXr1Cp06dQqrrbZaJcYCloNzDbWpVCpVegTaiB/nqAHf+973Qq9evcJxxx0XZs2aFZqamsLUqVPDlVdeGX74wx+G1VdfvdIjApmca4Dq5k10DRgwYEB45JFHwr777vvvb/uGEMKPf/zj8Otf/7pygwGFOdcA1U2JrgGvv/56GDlyZFhnnXXClClTQt++fcM//vGPcPbZZ4clS5aE3/72t5UeEcjkXANUNyW6Bpx66qlh8eLFYebMmf/+Fu/OO+8c1lprrXDEEUeE7373u2HIkCEVnhLI4VwDVDc/E10DZs6cGTbbbLP/9TOS2223XQghhOeee64SYwHLwbkGqG5KdA2or68Pzz//fFiyZMnnPv7II4+EEEJYb731KjEWsByca4DqViqXy+VKD8Hyue2228I+++wTdthhh3DSSSeFtdZaKzz66KPhvPPOC/379w9PPfWU67BgJeNcQ+2aNm1aaG5uDk1NTeGII44IBxxwQDjwwANDCCEMGzYsdO/evcITsiyU6Bpx7733hvPPPz8888wzobGxMfTr1y+MHDkyjBs3LvTp06fS4wEFONdQmwYMGBDeeOON/5i99tprYcCAASt2IApRogEAIJOfiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQKbORRe2tLSEhoaGUFdXF0qlUlvOBDWnXC6HpqamUF9fHzp1qt6vXZ1rWHbONdSenHNduEQ3NDSEfv36FV0OHdKcOXOq+p9rdq4hn3MNtWdZznXhL53r6uqKLoUOq9rPTbXPB9Wo2s9Ntc8H1WhZzk3hEu1bQpCv2s9Ntc8H1ajaz021zwfVaFnOTfX+EBcAAFQpJRoAADIp0QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMinRAACQSYkGAIBMSjQAAGRSogEAIJMSDQAAmZRoAADIpEQDAEAmJRoAADJ1rvQAAB3FwIEDk/kGG2wQzfbff/9oduSRRyb3nTJlSjRrbGyMZpMnT45mjz76aPKZALXOm2gAAMikRAMAQCYlGgAAMinRAACQSYkGAIBMSjQAAGRyxR1AprXWWiuabbnlltHs0ksvTe672WabFZqnXC4n8/3226/Qvoccckg0u+uuu5JrDzrooGi2dOnSQvMA1at79+7RrE+fPsm1c+bMaetxVghvogEAIJMSDQAAmZRoAADIpEQDAEAmJRoAADIp0QAAkEmJBgCATO6J7mB69OiRzEeNGhXNUnfNfvOb3yw8U6lUimZPP/10NDvllFOS+955552FZ4LzzjsvmqX+7LV2Z/PKZLXVVotmI0aMSK7985//HM0OOOCAaLZkyZLWBwPaRZcuXZL5z3/+82i2++67R7N+/fol920tr1beRAMAQCYlGgAAMinRAACQSYkGAIBMSjQAAGRSogEAIJMr7qpUa1fRHX744dFs8803j2Z77rlnct+i18ykrvVatGhRcu2rr74azbbddtto9oMf/CC5ryvuqKuri2Y33XRTcu1uu+3W1uO06qOPPopms2bNimapayJDSF9duemmm0az1BkbMmRI8plDhw6NZnvvvXc0u+6665L7Au3n4YcfTuZbb711oX0nT55caF218yYaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZXHFXQVtssUU0a+16ttVXXz2a3XPPPdFswoQJyX0vvvjiaNbc3BzNfvKTn0Szu+++O/nMQYMGRbMHHngguRa6du0azW6++eZo1tp1j0UtXbo0ml1wwQXJtbfddls0mzlzZtGRklL7zp07N5rde++9hZ+Z+j0Dlt/BBx8czYYNGxbNBg8enNz3rbfeimZnn312NHPFHQAAEEJQogEAIJsSDQAAmZRoAADIpEQDAEAmJRoAADIp0QAAkMk90e2se/fu0eymm26KZtOnT0/ue9VVV0WzBx98MJp98YtfTO47fvz4aHb11VdHs6ampuS+KT169Ci8Fr73ve9Fs6FDh7bLM1P3PZ9//vnRrLGxsT3GqYhSqVQ4nzdvXluPAx1O6t+aGDVqVDQbPnx4NGtpaUk+89hjj41mt99+e3JtLfImGgAAMinRAACQSYkGAIBMSjQAAGRSogEAIJMSDQAAmVxx184eeeSRaJa6Fm7MmDHJfRcuXFhonrfeeiuZX3bZZYX2Tdlkk02S+TrrrBPNUtf1TZw4sfBM1I7UlUvlcrnwvhMmTIhmZ511VuF920OvXr2Seeq6uRtvvDGabbPNNtGstV/bhx56KJrdddddybVACOPGjUvmxx13XDRLXWf717/+NZpNmjQp+cyOeI1dijfRAACQSYkGAIBMSjQAAGRSogEAIJMSDQAAmZRoAADI5Iq7NpC6ou2VV16JZr/61a/aY5yKmD9/fjRbsGBBcu3VV18dzaZPnx7NXJNFCCE8/vjj0WyrrbYqvG///v2j2frrrx/N3njjjWi27rrrJp+5/fbbR7ONN944mp166qnJfefOnRvNNttss+TamNR/ZwghHHLIIdHso48+KvRMqDWpK2DPOeec5NrUNZNvvvlmNPvZz34WzZ5//vnkM/k8b6IBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJDJFXdtYOnSpdFs2LBh0WzfffeNZjfddFPymYceemg0a2lpSa4tqkuXLoXW9evXL5mnrgv7xS9+UeiZdBxPPvlkNDvyyCML73vEEUdEs4MOOiiapa7c69u3b/KZm2++eeuD/QelUimZr7nmmoX2TVm8eHEyT13d1dralEWLFhVeC5UwYsSIaHbNNddEs9bO9aRJk6LZaaedFs1au3aWZedNNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMinRAACQqVQul8tFFi5evDj07NmzreepOUOHDo1mN998czRbY401kvuOGjUqmqXumO7Tp09y39133z2anXTSSdFs++23j2aHHHJI8pk33nhjMq8ljY2NoUePHpUeI2plPNeps3LLLbdEs/79+yf3Td1znLq/teCn1OXS2n2ylZipqakpms2bNy+azZ49O7nvyJEjo1nqzv725FzXvs6d4/+sxjbbbJNce+utt0az1Oevt956K7nv3nvvHc1efvnl5Fpatyzn2ptoAADIpEQDAEAmJRoAADIp0QAAkEmJBgCATEo0AABkcsVdBV122WXRbPTo0cm1DQ0N0Sx1pdzRRx+d3Dd1dd6bb74ZzY455phods899ySf+fHHHyfzWuIqrJXH3//+92i29tprR7ONN964PcZJqsYr7trrGsBjjz02mk2aNKnwvsvDua59vXr1imaPPvpocm3qc8IDDzwQzXbddddW56L9uOIOAADagRINAACZlGgAAMikRAMAQCYlGgAAMinRAACQqXOlB+jIfvKTn0SzrbbaKrl2p512imb33ntvNHvnnXcKz/SHP/whmi1cuDC5L1Sbn//858l86623jmarr756NGuv6+SWLl0azWbNmpVcO3Xq1LYeJ+y///7JfP31149mixcvjma9e/dO7nvJJZdEs8ceeyyazZw5M7kvxaSuN63UlYNFbbLJJtHs5JNPjmatXWuZuub1xBNPbHUuqpc30QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJvdEV9AhhxwSzVJ3rIYQQqlUKvTM1u7G/e1vf1toX6iULl26RLPUHbannXZact/VVlut0DwfffRRNLvyyiuTa1P3yc6ePTuaVeIO5N/85jfJvH///tHsxRdfjGbz5s1L7pv6ffn2t78dzdwT3T5WtrugU2699dZoNnDgwGjW2t3wp59+ejR7/vnnW52L6uVNNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMrnirg107do1mt18883RbI899ohmS5cuTT6zubk5mr355pvRbOrUqcl9odp07949mf/ud7+LZgcccEBbjxNCCGHy5MnRbMqUKdHsrrvuao9xKiJ15V5r+RprrFF439TVef369UuupfalrrwMIYTLLrssmg0aNCiaNTY2RrPjjjsu+cxHH300mbPy8iYaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZXHG3DNZbb71k/pe//CWaDR48OJq9/PLL0ey73/1u8pnbbbddNLv00kuj2bBhw5L7XnXVVckcVrTUGQqh/a6xu/jii6PZmDFj2uWZHcUpp5wSzVJX2LXmlVdeKbyW2tDa33FHHnlkNGtpaYlmqc8HN9xwQ+uDUZO8iQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCZX3H1m8803j2b//d//nVy79dZbR7PJkydHs/Hjx0ezuXPnJp/57LPPRrOjjz46mvXq1Su5L1Sbb3zjG8m8VCoV2vecc85J5qeffnqhfVc2AwcOjGYbbLBBNBs3blxy39TvW7lcbn2wiObm5mh2xx13FN6XlcdOO+0UzSZNmlR437POOiuanXnmmYX3pXZ5Ew0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZHJP9Gd+/OMfR7PW7ql9+eWXo9kxxxxTeKaUnj17RrO11147mu23337JfX/1q18Vngnaw0YbbZTMi945PHHixELrlkeXLl2SeV1dXTQbPnx4NNtyyy2T+2688cbRbJdddolma6yxRnLflNTvy6effhrNZs6cmdw3dZfvc8891+pcrPz23XffaNa7d+/k2qlTp0az1J8t+E+8iQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCZX3H1mnXXWiWalUim59sgjj2zrcVr19ttvR7N//etf0eydd95pj3Gg3cyZM6dd9p0+fXoyf/XVV6NZ6nNC6mq3L3zhC8lnbr/99sm8yDytzdRe/vKXv0SzJ598MpqdffbZ7TEOK5nx48dHs9TfuYceemhy3xtuuKHwTPD/5000AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyueLuM88880w0GzlyZHLtdtttF80efvjhwjO1h7/97W+VHgGyTJ48OZmPGjUqmm200UbRbLPNNkvum8qLXnHXXpqbm5P57NmzC2UXXHBBNHv22WeTz1ywYEEyp2Pr06dPMu/Xr180u++++6KZK+xYkbyJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyuSf6M1dccUU0W2ONNZJrL7744mi22mqrRbPf/OY30WzJkiXJZ6ak7n3daaedkmtTM0ElvPXWW8l82LBh0ezUU0+NZqn7pUMIoWvXrunBIm655ZZo1tjYmFybyv/0pz9Fs8WLFyf3fe6555I5rGgHH3xwMn/ggQei2TXXXNPW40Ah3kQDAEAmJRoAADIp0QAAkEmJBgCATEo0AABkUqIBACBTqVwul4ssXLx4cejZs2dbz1OVevfunczPO++8aHbAAQdEs9Qv/Z133pl85plnnhnNxo4dG81uv/325L6p67lYfo2NjaFHjx6VHiOqI51raCvONdSeZTnX3kQDAEAmJRoAADIp0QAAkEmJBgCATEo0AABkUqIBACCTK+7a2UYbbRTNTjjhhGg2evTo5L5vv/12NNtmm22i2bx585L70r5chQW1x7mG2uOKOwAAaAdKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCZX3MEK5CosqD3ONdQeV9wBAEA7UKIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQKbCJbpcLrflHNAhVPu5qfb5oBpV+7mp9vmgGi3LuSlcopuamoouhQ6r2s9Ntc8H1ajaz021zwfVaFnOTalc8EvUlpaW0NDQEOrq6kKpVCqyBXQY5XI5NDU1hfr6+tCpU/X+FJVzDcvOuYbak3OuC5doAADoqKr3S2cAAKhSSjQAAGRSogEAIJMSDQAAmZRoAADIpEQDAEAmJRoAADIp0QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJn+Pxgo4T95/MmcAAAAAElFTkSuQmCC\n",
      "text/plain": [
       "<Figure size 900x900 with 9 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "plots(x_trn[:9], y_trn[:9])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "For gradient descent to work efficiently it is important that all the input variables or features are roughly on the same order of magnitude. Typically, we try to get them around 1."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [],
   "source": [
    "def normalize(x): return x / 255"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [],
   "source": [
    "x_trn = normalize(x_trn)\n",
    "x_val = normalize(x_val)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[0.99215686, 0.99215686, 0.76862745],\n",
       "       [0.85098039, 0.98431373, 0.99215686],\n",
       "       [0.        , 0.20784314, 0.9254902 ]])"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "x_trn[0, 12:15, 12:15]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAbwAAAGiCAYAAACcbHM0AAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjUuMywgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy/NK7nSAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAc0ElEQVR4nO3dcWyU9R3H8c8J5cpMew5qS5mlLYtWBHXYqi2xOiQrtJGAkgWjqWXZ3LqABDoyKbpMXZZmi3PEqBA2wCi6kazgMBBGE2nrQlGLRbZYOrYh7UhrLcM7rPMK7Lc/DJfVHoXWe67tfd+v5Em4p7/n7vfbY/re09718TnnnAAASHBXjPQEAACIB4IHADCB4AEATCB4AAATCB4AwASCBwAwgeABAEwgeAAAEwgeAMAEggcAMMHT4J0+fVrl5eUKBAIKBAIqLy/Xxx9/POgxy5Ytk8/n67cVFhZ6OU0AgAHjvXzyBx54QP/617+0d+9eSdL3v/99lZeX6/XXXx/0uAULFmjr1q2RxxMmTPBymgAAAzwLXmtrq/bu3auDBw/q9ttvlyT95je/UVFRkdra2pSXl3fRY/1+v6ZMmeLV1AAABnkWvKamJgUCgUjsJKmwsFCBQEAHDhwYNHj19fVKT0/XVVddpbvuuks///nPlZ6eHnVsOBxWOByOPP7vf/+rf//735o8ebJ8Pl/sFgQAiAvnnM6cOaOpU6fqiiti95s3z4LX1dUVNVLp6enq6uq66HGlpaX69re/rezsbB0/flw/+clPdPfdd+vQoUPy+/0DxtfU1OjJJ5+M6dwBACOvo6ND11xzTcyeb8jBe+KJJy4ZmHfeeUeSol5hOecGvfJaunRp5N+zZs1SQUGBsrOztXv3bt13330DxldXV6uqqiryOBgMatq0aero6FBqauol1wNg7Hj77bdHegqIg97eXi1evFgpKSkxfd4hB2/FihW6//77Bx2Tk5OjI0eO6MMPPxzwtY8++kgZGRmX/XqZmZnKzs7WsWPHon7d7/dHvfJLTU0leECCufLKK0d6CoijWP9aasjBS0tLU1pa2iXHFRUVKRgM6u2339Ztt90mSXrrrbcUDAY1Z86cy369U6dOqaOjQ5mZmUOdKgAAEZ59Dm/GjBlasGCBHn74YR08eFAHDx7Uww8/rHvuuaffG1auv/567dy5U5L0ySefaM2aNWpqatIHH3yg+vp6LVy4UGlpabr33nu9mioAwABPP3j+yiuv6MYbb1RJSYlKSkp000036eWXX+43pq2tTcFgUJI0btw4/eUvf9GiRYt03XXXqaKiQtddd52amppi/rNcAIAtnn7wfNKkSdq2bdugY5xzkX9PnDhRf/rTn7ycEgDAKP6WJgDABIIHADCB4AEATCB4AAATCB4AwASCBwAwgeABAEwgeAAAEwgeAMAEggcAMIHgAQBMIHgAABMIHgDABIIHADCB4AEATCB4AAATCB4AwASCBwAwgeABAEwgeAAAEwgeAMAEggcAMIHgAQBMIHgAABMIHgDABIIHADCB4AEATCB4AAATCB4AwASCBwAwgeABAEwgeAAAEwgeAMAEggcAMIHgAQBMIHgAABMIHgDABIIHADCB4AEATCB4AAATCB4AwASCBwAwgeABAEwgeAAAEwgeAMAEggcAMIHgAQBMIHgAABMIHgDABIIHADCB4AEATIhL8F544QXl5uYqOTlZ+fn5evPNNwcd39DQoPz8fCUnJ2v69OnauHFjPKYJAEhgngdv+/btWrVqlR577DG1tLSouLhYpaWlam9vjzr++PHjKisrU3FxsVpaWrRu3TqtXLlStbW1Xk8VAJDAfM455+UL3H777brlllu0YcOGyL4ZM2Zo8eLFqqmpGTD+0Ucf1a5du9Ta2hrZV1lZqffee09NTU0DxofDYYXD4cjjUCikrKwsBYNBpaamxng1AEZStO8BSDy9vb361re+FfPv455e4fX19enQoUMqKSnpt7+kpEQHDhyIekxTU9OA8fPnz1dzc7POnj07YHxNTY0CgUBky8rKit0CAAAJw9Pg9fT06Pz588rIyOi3PyMjQ11dXVGP6erqijr+3Llz6unpGTC+urpawWAwsnV0dMRuAQCAhDE+Hi/i8/n6PXbODdh3qfHR9kuS3++X3++PwSwBAInM0yu8tLQ0jRs3bsDVXHd394CruAumTJkSdfz48eM1efJkz+YKAEhsngZvwoQJys/PV11dXb/9dXV1mjNnTtRjioqKBozft2+fCgoKlJSU5NlcAQCJzfOPJVRVVem3v/2ttmzZotbWVq1evVrt7e2qrKyU9Pnv4B566KHI+MrKSp04cUJVVVVqbW3Vli1btHnzZq1Zs8brqQIAEpjnv8NbunSpTp06paeeekqdnZ2aNWuW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/vp++37wgx+4wsJCz+YYa0Nd8/79+50kd/r06TjMLj4kuZ07dw46JhHO9f+7nDUn4rnu7u52klxDQ8NFxyTauXbu8tYdq/M95q/wmpqaFAgEdPvtt0f2FRYWKhAI6MCBA4MeW19fr/T0dF133XV6+OGH1d3d7fV0h6Wvr0+HDh1SSUlJv/0lJSUXXWNTU9OA8fPnz1dzc7POnj3r2VxjZThrvmD27NnKzMzUvHnztH//fi+nOSqM9XP9ZSTSub6c26cl4rke6m3jvsz5HvPB6+rqUnp6+oD96enpkT9lFk1paaleeeUVvfHGG/rVr36ld955R3fffXe/Ww2NFj09PTp//rwyMjL67c/IyLjoGru6uqKOP3funHp6ejyba6wMZ82ZmZnatGmTamtrtWPHDuXl5WnevHlqbGyMx5RHzFg/18ORaOfaOaeqqirdcccdmjVr1kXHJdq5vtx1x+p8x/UGsEPxxBNPXPLGru+8846k6H/CzDl30T9tJklLly6N/HvWrFkqKChQdna2du/erfvuu2+Ys/bWF9dzqTVGGx9t/2g2lDUP9dZSiSQRzvVQJNq5vtzbp0mJda69um3cxYza4K1YsUL333//oGNycnJ05MgRffjhhwO+9tFHHw34f0KDyczMVHZ29qi8DVFaWprGjRs34Mqmu7v7omucMmVK1PHjx4/X5MmTPZtrrAxnzdEUFhZq27ZtsZ7eqDLWz3WsjNVzfeH2aY2NjZe8fVoineuhrDua4ZzvURu8tLQ0paWlXXJcUVGRgsGg3n77bd12222SpLfeekvBYFBz5sy57Nc7deqUOjo6RuVtiCZMmKD8/HzV1dXp3nvvjeyvq6vTokWLoh5TVFSk119/vd++ffv2qaCgQElJSZ7ONxaGs+ZoLNxaaqyf61gZa+faDeP2aYlwroez7miGdb6/1FteRokFCxa4m266yTU1NbmmpiZ34403unvuuaffmLy8PLdjxw7nnHNnzpxxP/rRj9yBAwfc8ePH3f79+11RUZH72te+5kKh0Egs4ZJ+//vfu6SkJLd582b3/vvvu1WrVrkrr7zSffDBB84559auXevKy8sj4//5z3+6r3zlK2716tXu/fffd5s3b3ZJSUnuD3/4w0gtYciGuuZf//rXbufOne5vf/ub++tf/+rWrl3rJLna2tqRWsKwnDlzxrW0tLiWlhYnyT3zzDOupaXFnThxwjmXmOd6qGtOhHP9wx/+0AUCAVdfX+86Ozsj26effhoZk4jnejjrjtX5TojgnTp1yj344IMuJSXFpaSkuAcffHDA21clua1btzrnnPv0009dSUmJu/rqq11SUpKbNm2aq6iocO3t7fGf/BA8//zzLjs7202YMMHdcsst/d7GW1FR4e66665+4+vr693s2bPdhAkTXE5OjtuwYUOcZ/zlDWXNv/jFL9zXv/51l5yc7L761a+6O+64w+3evXsEZv3lXHgL9he3iooK51xinuuhrjkRznW09f7/9ynnEvNcD2fdsTrf3B4IAGDCmP9YAgAAl4PgAQBMIHgAABMIHgDABIIHADCB4AEATCB4AAATCB4AwASCBwAwgeABAEwgeAAAE/4HdIwFmyJUio0AAAAASUVORK5CYII=\n",
      "text/plain": [
       "<Figure size 640x480 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "plt.imshow(x_trn[0, 12:15, 12:15], cmap='gray');"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now we will do something pretty dumb. We will flatten out the images and throw away all spatial information."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [],
   "source": [
    "def flatten(x): return x.reshape(x.shape[0], -1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [],
   "source": [
    "x_trn = flatten(x_trn)\n",
    "x_val = flatten(x_val)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(48000, 784)"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "x_trn.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAHoUAAAA7CAYAAACpmqb0AAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjUuMywgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy/NK7nSAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAdbUlEQVR4nO3df5BV5X0/8PcF3BUNLAJZkKqIjVoViQoOLEaTRiUhaupkxpgmoTD+qLaYlhKnCXU6JRolqY0haUY6mNT4Iy1OVYzWn2Qa0EhJkMpoSEpNxQC6G6IiApJdhO0fafbb/YrwsHtvdmVfr5k74z3nfc99Dt597vmc85z7VNrb29sDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAXvXr6QYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC8E5gUGgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoIBJoQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAqYFBoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKCASaEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKmBQaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACggEmhAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACpgUGgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoIBJoQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAqYFBoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKBAzSaF3rx5c6ZNm5aGhoY0NDRk2rRpee211/b6mhkzZqRSqXR6TJo0qVZNBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKDagVhv+5Cc/mY0bN+aRRx5JkvzxH/9xpk2blgceeGCvr/vwhz+cW2+9teN5XV1drZoIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQrCaTQv/0pz/NI488khUrVmTixIlJkltuuSVNTU1Zu3Ztjj/++Ld9bX19fUaOHFmLZgEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHRZTSaF/vd///c0NDR0TAidJJMmTUpDQ0OWL1++10mhly5dmsbGxgwZMiTvf//7c/3116exsfFt862trWltbe14vnv37rz66qsZNmxYKpVKdXYIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ILW3t2fr1q0ZNWpU+vXrt9dsTSaFbmlp2eNEzo2NjWlpaXnb102dOjUXXXRRRo8enXXr1uWv//qv88EPfjCrVq1KfX39Hl8zb968fOELX6ha2wEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgL5nw4YNOeKII/aa2a9JoefOnbvPCZhXrlyZJKlUKkmSm2++OTfeeGOam5uTJC+88MLbvvbiiy/OsmXLMn369KxZsyYjRozIxo0b8+CDD+ZjH/vYHl8zZ86czJ49u+P5li1bctRRR+3PbgEAAAAAAOy3IUOGFOX2dbHmQPLqq68W5V566aUat4RSgwYNKsqNGzdun5knn3yyu83pksmTJxflPvzhDxflJk2a1J3mdMmwYcOKcsccc0yNW9K7bNq0qSh3/PHH17gllLjpppuKckOHDi3KzZgxoyg3YcKEotw///M/F+UOO+ywolz//v2Lcr/85S+Lclu3bi3K9SX/8i//UpQ79dRT95l55plnirZ1/fXXF+XouksuuaQod+ONNxblHnjggaLc/x1btDc/+tGPinKl392rVq0qyv393//9PjM//OEPi7bV0tJSlIPebMCAsmGNS5YsKcqdcsopRblFixYV5WbOnFmUKz1vUGLbtm1Fuba2tqq9JxwoSs8HlNYMvxkPvS9nnnlmUe6VV14pygG9w1e+8pWiXGnt8+abb+4zU9rvlNq4cWNRrnRfH3/88aLczp07i3LQl3zuc5/bZ+bzn//8b6ElvUfp+Y/HHnusKFd63hre6err64tyDz/8cFHujTfeKMr9+Mc/LsqVOvfcc4tyRx99dFGuX79+3WhNZ9/97neLcpdeemlRbteuXd1pDlAlJdcZk+Tee+8tylXznHCS/OxnPyvKTZw4sSi3e/fu7jQHqJLSY5kvf/nLRbkpU6Z0ozVdf98vfelLVX1foLZ+8/s/+3LdddcV5Uqumb/22mtF2zr77LOLcs8//3xRDkqVjMn2ueu6d73rXUW573//+0W597znPUW58847ryi3fPnyohyUKB2zOXXq1KLc008/3Z3m9Gml52f/7u/+riinT6EnlB5Hn3POOUW5p556qhut6dumTZtWlPv6179elNOn0BO2bNlSlDv//POLck888UR3mnNAGjNmTFHu7rvvLsqV1Kr6E3rKT37yk6JcybjYhQsXFm3rO9/5TlFu8+bNRblSpfc0ve997yvKnXjiiUW5K664oihX8pvr27dvL9rWhz70oaLcmjVrinJQ4thjjy3KlY7VKP09n9Ix+b/61a+KcqVKr9GUXkeuppI+O0k+/elPF+UeffTR7jQHaqr02P2qq64qyp111llFudLrGz2h9Pc3Su9B+upXv1qUc74K3qqhoaEo15t/x7B0vGtra2uNWwIAAAC1U/Ib7vs1KfRVV12VT3ziE3vNHH300XnmmWfyi1/8InfddVdmzZqVm2++OWeccUZOOeWU3Hbbbbnmmmv2eBFx3bp1+chHPpLLL788d955Z5588slcfvnluffee992Uuj6+vriHy4AAAAAAAColtKbL0onjTwQVPNHlfntKP0cl97A2BNK23bwwQcX5Q499NDuNKdLSn/4avDgwTVuSe+yY8eOnm4C+2HgwIFFuUMOOaSq71vaB5QMoEjK/85Kv99Lb/5sb28vyvUlpf12yWeqdFvUXl1dXVGu9G+xtE8pPU6tdl9Relxx0EEH7TPjWJu+pLROqfZxdOnxTGn7qvl3W/qewFuVfM8m5X1F6STtvrvhwFR6vFDap5T8kFJpv1OqtE4pPefiOAW6ruReqL52XaC0j3IfGXRW7XMppdur9rn3ap/rqWZdVnou2rERvLOUXvOt9vWjUtXut4HeofQYpfT4o9p9j/EVcGCqdp1X0vfs2rWraFuuqdFTfPZqq6fG/vTmex44cFV77DldV+0xyvoUeoLPZ++hT+FA4PNZe6W1ZTVrH/+/6Cml10xLxsWWjv3qqeug1f7thdL9reZ16dIaVK1KT+ipsRqlY/Kr/V1berzQE+OFSyeFLr0vC3qz0r/F0nuGDoTfCCrdh9LxK2oV6LoD4XcMjWMFAACgLyipf/frLNnw4cMzfPjwfeaampqyZcuWXHfddbn00ktz2WWX5Yc//GHa2tpyzDHHZMGCBZk3b95bXvcP//APOeqoozJ//vwkSWNjY6644oqsWLFif5oJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQdf1qsdETTjghU6ZMyZo1azJ69OisWLEil19+ec4///ycf/75Wb58eZLk937v97J48eIkybZt2/Kd73wnJ598cl544YUsXbo0F1xwQYYMGZKf//zn2blz5x7fq7W1Na+//nqnBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQLXVZFLoJLnpppuSJNddd12mTJmScePG5Y477siIESPS0tKSJFm7dm22bNmSJOnfv382b96cBx98MMcdd1ymT5+e4447Lt/85jfz5ptv5uWXX97j+8ybNy8NDQ0djyOPPLJWuwQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPRhNZsU+rDDDkuS/Mmf/EmGDRuWu+++O2effXbWrVuXSqWSJGlvb8+MGTOSJAMHDsxhhx2WN954Izt37sz69etz22235WMf+1iSdLzm/zdnzpxs2bKl47Fhw4Za7RIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANCH1WxS6OHDh6dSqeRrX/tarrnmmjz99NM588wzc9ttt6WhoWGPrxk6dGiSZO3atWlubk5zc3O+9a1vpX///hk2bNgeX1NfX5/Bgwd3egAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFRbzSaFrquryyGHHJLjjjsul112WU444YTMnz8/lUol/frt+W1POumkJEljY2NGjhyZkSNHZuXKlTn99NNz0EEH1aqpAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+zSgVhtua2vLjh07snbt2vzjP/5jmpqasnDhwuzevTu7d+9OksyZMycvvvhibr/99iTJRz/60SxatCijR49OXV1dhg8fnueeey533XXX275Pa2trWltbO55v2bKlVrsEAAAAAADQob29vSi3a9euGrek9/jNNSDeOUo/x2+++WaNW9J1pW371a9+VZTbvn17d5rTJQcffHBR7vXXX69xS3qXrVu39nQT2A87duwoyr3xxhtVfd/SPqD08zRgQNkwiv79+1f1fbdt21aU60tK++2Sz1Tptqi9tra2olzpd15pn1J6nFr6N1tXV1eUKz2u2Llz5z4zjrXpS0rrlNLvz9I+pfR4prR91fy7LX1P4K1KvmeT8r6i9HjBdzccmEqPF0r7lJLzGtU+R1Zap5Sec3GcAl33f++Fejt97bpAaR9V8m8HfUm1z6WUnnet9rn3ap/r6devX3ea00npv4ljI3hn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mhtvvDGXXHKJehsAAAC6Ydu2bTnttNNy880354tf/GJOOeWUzJ8/3zVuAAAA6KK5c+fmvvvuy+rVq9+yTr0NAAAAXfP5z38+Tz75ZJ544ok9rldzAwAAQHXMmjUr//qv/5rnnnsuSdTbAAAASfr1dANqqa2tLatWrcqUKVM6LZ8yZUqWL1/eQ60CAACAd65169alpaWlU61dX1+f97///R219qpVq7Jz585OmVGjRmXs2LHqcQAAAPhfW7ZsSfLrSaoSNTcAAABUw65du7Jo0aJs3749TU1N6m0AAADoppkzZ+a8887LOeec02m5mhsAAAC67rnnnsuoUaMyZsyYfOITn8jzzz+fRL0NAAAAXXX//fdnwoQJueiii9LY2JhTTz01t9xyS8d6NTcAAAB0X1tbW+68885ccsklqVQq6m0AAID/dUBPCv3yyy9n165dGTFiRKflI0aMSEtLSw+1CgAAAN65flNP763WbmlpSV1dXQ477LC3zQAAAEBf1t7entmzZ+d973tfxo4dm0TNDQAAAN3x7LPP5l3velfq6+tz5ZVXZvHixTnxxBPV2wAAANANixYtyn/8x39k3rx5b1mn5gYAAICumThxYm6//fY8+uijueWWW9LS0pLJkyfnlVdeUW8DAABAFz3//PNZsGBBjj322Dz66KO58sor82d/9me5/fbbk7jGDQAAANVw33335bXXXsuMGTOSqLcBAAB+Y0BPN+C3oVKpdHre3t7+lmUAAABAua7U2upxAAAA+LWrrroqzzzzTH7wgx+8ZZ2aGwAAAPbf8ccfn9WrV+e1117LPffck+nTp2fZsmUd69XbAAAAsH82bNiQP//zP89jjz2Wgw8++G1zam4AAADYP1OnTu3475NPPjlNTU353d/93dx2222ZNGlSEvU2AAAA7K/du3dnwoQJueGGG5Ikp556atasWZMFCxbkj/7ojzpyam4AAADoum9961uZOnVqRo0a1Wm5ehsAAOjr+vV0A2pp+PDh6d+/f1paWjot37RpU0aMGNFDrQIAAIB3rpEjRybJXmvtkSNHpq2tLZs3b37bDAAAAPRVn/nMZ3L//ffn+9//fo444oiO5WpuAAAA6Lq6urq85z3vyYQJEzJv3ry8973vzde+9jX1NgAAAHTRqlWrsmnTpowfPz4DBgzIgAEDsmzZsnz961/PgAEDOmpmNTcAAAB0z6GHHpqTTz45zz33nGvcAAAA0EWHH354TjzxxE7LTjjhhKxfvz6J+7gBAACgu37+85/ne9/7Xi677LKOZeptAACAXzugJ4Wuq6vL+PHjs2TJkk7LlyxZksmTJ/dQqwAAAOCda8yYMRk5cmSnWrutrS3Lli3rqLXHjx+fgw46qFOmubk5P/7xj9XjAAAA9Fnt7e256qqrcu+99+bf/u3fMmbMmE7r1dwAAABQPe3t7WltbVVvAwAAQBedffbZefbZZ7N69eqOx4QJE/KpT30qq1evzjHHHKPmBgAAgCpobW3NT3/60xx++OGucQMAAEAXnXHGGVm7dm2nZf/1X/+V0aNHJ3EfNwAAAHTXrbfemsbGxpx33nkdy9TbAAAAvzagpxtQa7Nnz860adMyYcKENDU1ZeHChVm/fn2uvPLKnm4aAAAA9Erbtm3Lz372s47n69aty+rVqzN06NAcddRRmTVrVm644YYce+yxOfbYY3PDDTfkkEMOySc/+ckkSUNDQy699NJ89rOfzbBhwzJ06NBcffXVOfnkk3POOef01G4BAABAj5o5c2b+6Z/+Kd/97nczaNCgtLS0JPl1HT1w4MBUKhU1NwAAAHTBX/3VX2Xq1Kk58sgjs3Xr1ixatChLly7NI488ot4GAACALho0aFDGjh3badmhhx6aYcOGdSxXcwMAAMD+u/rqq3PBBRfkqKOOyqZNm/LFL34xr7/+eqZPn+4aNwAAAHTRX/zFX2Ty5Mm54YYb8vGPfzw/+tGPsnDhwixcuDBJ1NwAAADQDbt3786tt96a6dOnZ8CA/zfVmXobAADg1w74SaEvvvjivPLKK7n22mvT3NycsWPH5qGHHsro0aN7umkAAADQKz311FP5/d///Y7ns2fPTpJMnz493/72t/OXf/mX2bFjR/70T/80mzdvzsSJE/PYY49l0KBBHa/56le/mgEDBuTjH/94duzYkbPPPjvf/va3079//9/6/gAAAEBvsGDBgiTJBz7wgU7Lb7311syYMSNJ1NwAAADQBb/4xS8ybdq0NDc3p6GhIePGjcsjjzySc889N4l6GwAAAGpFzQ0AAAD7b+PGjfnDP/zDvPzyy3n3u9+dSZMmZcWKFR2/iabeBgAAgP13+umnZ/HixZkzZ06uvfbajBkzJvPnz8+nPvWpjoyaGwAAALrme9/7XtavX59LLrnkLevU2wAAAEmlvb29vacbAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0Nv16+kGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvBOYFBoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKCASaEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKmBQaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACggEmhAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACpgUGgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoIBJoQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAqYFBoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKCASaEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKmBQaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACggEmhAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACpgUGgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoMD/ALiQX/sJkMtIAAAAAElFTkSuQmCC\n",
      "text/plain": [
       "<Figure size 10000x100 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "fig = plt.figure(figsize=(100, 1))\n",
    "plt.imshow(x_trn[0, None, :], cmap='gray');"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We are dealing with a classification problem. That means that the correct answer to always one of 10 classes. To pass the numbers to the neural net we one-hot encode the labels."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [],
   "source": [
    "yoh_trn = to_categorical(y_trn)\n",
    "yoh_val = to_categorical(y_val)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(array([5, 0, 1], dtype=uint8),\n",
       " array([[0., 0., 0., 0., 0., 1., 0., 0., 0., 0.],\n",
       "        [1., 0., 0., 0., 0., 0., 0., 0., 0., 0.],\n",
       "        [0., 1., 0., 0., 0., 0., 0., 0., 0., 0.]], dtype=float32))"
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "y_trn[:3], yoh_trn[:3]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Training a simple linear network\n",
    "\n",
    "To start, let's train a simple linear network."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-09-21 15:31:37.379255: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  SSE4.1 SSE4.2\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    }
   ],
   "source": [
    "linear_model = Sequential([\n",
    "    Dense(10, input_shape=(784,), activation='softmax'),\n",
    "])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "After the matrix multiplication we are using a Softmax layer."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [],
   "source": [
    "def softmax(x):\n",
    "    np.exp(x) / np.sum(np.exp(x))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [],
   "source": [
    "x = [2, 6, 3, 5]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([  7.3890561 , 403.42879349,  20.08553692, 148.4131591 ])"
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "np.exp(x)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(array([0.01275478, 0.69638749, 0.03467109, 0.25618664]), 1.0)"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "out = np.exp(x) / np.sum(np.exp(x))\n",
    "out, out.sum()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Next we need to judge how good our predictions is. For classification we use the categorical crossentropy:\n",
    "\n",
    "$L = - \\sum_c y_t^c \\log(y_p^c)$\n",
    "\n",
    "$c$ is the class, so one of our ten numbers."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [],
   "source": [
    "linear_model.compile('adam', 'categorical_crossentropy', metrics=['accuracy'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Model: \"sequential\"\n",
      "_________________________________________________________________\n",
      " Layer (type)                Output Shape              Param #   \n",
      "=================================================================\n",
      " dense (Dense)               (None, 10)                7850      \n",
      "                                                                 \n",
      "=================================================================\n",
      "Total params: 7,850\n",
      "Trainable params: 7,850\n",
      "Non-trainable params: 0\n",
      "_________________________________________________________________\n"
     ]
    }
   ],
   "source": [
    "linear_model.summary()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1/10\n",
      "94/94 [==============================] - 0s 3ms/step - loss: 1.2841 - accuracy: 0.6735 - val_loss: 0.7472 - val_accuracy: 0.8315\n",
      "Epoch 2/10\n",
      "94/94 [==============================] - 0s 2ms/step - loss: 0.6158 - accuracy: 0.8563 - val_loss: 0.5290 - val_accuracy: 0.8695\n",
      "Epoch 3/10\n",
      "94/94 [==============================] - 0s 2ms/step - loss: 0.4825 - accuracy: 0.8791 - val_loss: 0.4460 - val_accuracy: 0.8860\n",
      "Epoch 4/10\n",
      "94/94 [==============================] - 0s 2ms/step - loss: 0.4220 - accuracy: 0.8903 - val_loss: 0.4020 - val_accuracy: 0.8951\n",
      "Epoch 5/10\n",
      "94/94 [==============================] - 0s 2ms/step - loss: 0.3867 - accuracy: 0.8976 - val_loss: 0.3734 - val_accuracy: 0.9038\n",
      "Epoch 6/10\n",
      "94/94 [==============================] - 0s 2ms/step - loss: 0.3632 - accuracy: 0.9030 - val_loss: 0.3541 - val_accuracy: 0.9078\n",
      "Epoch 7/10\n",
      "94/94 [==============================] - 0s 2ms/step - loss: 0.3462 - accuracy: 0.9061 - val_loss: 0.3404 - val_accuracy: 0.9106\n",
      "Epoch 8/10\n",
      "94/94 [==============================] - 0s 2ms/step - loss: 0.3337 - accuracy: 0.9091 - val_loss: 0.3313 - val_accuracy: 0.9134\n",
      "Epoch 9/10\n",
      "94/94 [==============================] - 0s 2ms/step - loss: 0.3234 - accuracy: 0.9113 - val_loss: 0.3216 - val_accuracy: 0.9138\n",
      "Epoch 10/10\n",
      "94/94 [==============================] - 0s 2ms/step - loss: 0.3148 - accuracy: 0.9134 - val_loss: 0.3151 - val_accuracy: 0.9151\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "<keras.callbacks.History at 0x18e812d10>"
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "linear_model.fit(x_trn, yoh_trn, batch_size=512, epochs=10, validation_data=(x_val, yoh_val))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "3/3 [==============================] - 0s 2ms/step\n"
     ]
    }
   ],
   "source": [
    "preds = linear_model.predict(x_val, 4096)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[4.26923252e-05, 2.75246362e-06, 6.45465025e-06, 6.76466757e-03,\n",
       "        4.51489905e-04, 5.15809690e-04, 1.29256905e-05, 9.85740840e-01,\n",
       "        2.14161561e-03, 4.32076445e-03],\n",
       "       [1.29225271e-04, 2.49533082e-06, 1.24960832e-04, 9.97798860e-01,\n",
       "        3.06820903e-06, 1.63070287e-03, 2.67268479e-05, 7.09658366e-07,\n",
       "        2.36515349e-04, 4.68056423e-05],\n",
       "       [2.19915668e-03, 1.48081884e-03, 2.33716215e-03, 2.49240212e-02,\n",
       "        3.25820845e-04, 5.03865778e-02, 6.90515953e-05, 1.43472294e-04,\n",
       "        9.09490168e-01, 8.64378549e-03]], dtype=float32)"
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "preds[:3]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([7, 3, 8])"
      ]
     },
     "execution_count": 29,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "num_preds = np.argmax(preds, axis=1); num_preds[:3]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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iQYAgExKNAAAZFKiAQAgkxINAACZOtWKu6KOOuqowvlXvvKVaLbxxhsXnim1CmunnXYqfG5jY2M0u+OOO6JZauXeoYceWnieBx98sPCz0BbTpk2LZlOnTl1/g1SpltbqWY9HNVq+fHk0e+GFF6LZLrvsEs369++ffOfdd98dzVJr6gYOHJg899e//nU0+8IXvhDNZs+eHc0WLlyYfCcf50s0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJCprlQqlYo8uGrVqtDQ0NDe89BBnXXWWdHsnHPOST77xBNPRLODDz44mqX2fVarpqam0Lt370qPEeVe/z8F/9HIf6mrq6v0COuNe10bUvuef/e730WzoUOHlmOccMkllyTzG264IZr99re/jWb77rtvNHv++edbHqyTaM299iUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZulZ6AGrDmWeeWfjZu+++O5p1xDV2sL7NnTs3md9///3RbOTIkdFs1KhRBScKYc6cOdFs9OjRhc+Fcnn99dej2YsvvhjNyrXi7tvf/nYyP/fcc6PZVltt1d7j8H/wJRoAADIp0QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmsuKPVtthii2i28cYbR7NSqZQ897777is8E5RLag3b1KlTo1lqnVy5TJs2rSznptbUtbT+LpWn5i3Xvxdoi7q6ukJZW3Tpkv7OmVpPedddd7X3OPwffIkGAIBMSjQAAGRSogEAIJMSDQAAmZRoAADIpEQDAEAmJRoAADLZE02r3XzzzYWea2kP9OOPP17oXCinuXPnFspqSWrndUt7oqGj6d+/fzTbeuuto1lLfxbCAw88EM169eoVzXbffffkubfeems0+9KXvhTNZs+enTyX1vMlGgAAMinRAACQSYkGAIBMSjQAAGRSogEAIJMSDQAAmay442NSa6s+97nPRbMuXeK/H7v77ruT71y7dm2LcwFAW22++ebR7LbbbotmQ4cOjWb33HNP8p1f/OIXo9lBBx0UzW655ZbkuRtuuGE0O+SQQ6KZFXftx5doAADIpEQDAEAmJRoAADIp0QAAkEmJBgCATEo0AABksuKOjznssMOiWalUimYrV66MZnPmzGnLSEAZpdZaTp06df0NAu1gwIAByXzWrFnRbM8994xmS5YsiWbH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44zw5ptvhueeey689NJLYd68eeHtt98OPXv2DLvvvnulxwPa0fDhw8PatWvDkiVLKj0KUIBfs2uHn4muEd26dQs777xzCCGEV155JcyaNSt89atfDd27d6/wZEB7mjNnTujSpUvYZpttKj0KUJBfs2uDH+fo4BYuXBhuv/32sMcee4Ru3bqFZ555JlxwwQVh6623DnPmzAm9evWq9IhAAV/72tdC7969w/Dhw0P//v3Dm2++GW699dYwa9ascPrpp4cf/ehHlR4RyOTX7NqiRHdwf/3rX8NXv/rVsHDhwrB69eowaNCgMHHixDBlypTQs2fPSo8HFDRz5swwc+bM8Oc//zmsXLky9OrVK+y6665h8uTJ4eijj670eEABfs2uLUo0AABk8n8sBACATEo0AABkUqIBACCTEg0AAJmUaAAAyKREAwBApsJ/YuG6detCY2NjqK+vD3V1de05E9ScUqkUmpubw4ABA0KXLtX7e1f3GlrPvYbak3OvC5foxsbGMHDgwKKPQ6e0dOnSsOWWW1Z6jCj3GvK511B7WnOvC//Wub6+vuij0GlV+72p9vmgGlX7van2+aAatebeFC7R/ichyFft96ba54NqVO33ptrng2rUmntTvT/EBQAAVUqJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMinRAACQSYkGAIBMSjQAAGRSogEAIJMSDQAAmZRoAADIpEQDAEAmJRoAADIp0QAAkEmJBgCATF0rPQBAR7PDDjtEsy984QvRbPLkyclzBw4cWGieurq6ZF4qlaLZypUro9kll1wSze65557kO5944olkDtDR+RINAACZlGgAAMikRAMAQCYlGgAAMinRAACQSYkGAIBMVtwBZLr55puj2a677lr43NQqunI8F0IIDQ0N0WzatGnRbLfddkueO3369Ghm/R1QC3yJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAy2RPdQW200UbRbNy4cdHstttuK/zO2bNnR7PUPtmFCxcWfidUyvbbbx/N+vXrtx4nqU7jx49P5vvuu2+hzA5pOpPevXtHs1122SX57Fe+8pVCz/7iF7+IZtddd13ynXycL9EAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMhkxV0F9ejRI5o1NDQkn/23f/u3aLbPPvtEs1Kp1PJgEamVVptvvnk0Gz16dPLcDz74oOhIUDa77rprNBswYEChM1NrIkMIYcGCBdHsmmuuKfTOEELo27dvNDvrrLOi2VFHHVX4nfX19dHsvvvui2abbrpp4XdCJbT0z4PUCtgxY8ZEs4EDBybPTf3auXbt2mj2k5/8JJptvfXWyXem/r10Rr5EAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgU12p4M6zVatWtbiGjRAGDRoUzS6//PJodvDBBxd+Z11dXTRry4q7on70ox8l8zPPPHM9TVJ5TU1NoXfv3pUeI8q9/n+6d+8ezVL/nb3zzjuj2bPPPpt8ZyXWPXbtGt90ev3110ezI488svA7U/8+U3/fq5V7XftSa1zvvffe5LM77bRTNJsxY0Y0u+eee5Ln/v3vf49mq1evjmY//vGPo9nw4cOT70x1k/nz5yef7Whac699iQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMsUXhNJqqT2Cv//976PZ9ttvX45xQmNjYzR7/fXXk8+m9lr36dOn0Dy77LJLoeegktasWRPNvv/976/HScortf923Lhx63ESqKxRo0ZFs9Sf67Dddtslzz3hhBOiWWpPdLnceuut0eyAAw5IPnveeedFs/3226/wTB2VL9EAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMhkxV0rNDQ0JPNf/vKX0axca+x+/OMfR7PUypy33347ee5TTz1VeCag49ltt92iWa9evQqfu3bt2mh20kknFT4X2qJ///7R7JJLLolmO+20UzRbvHhx8p2VWGNXLlbWfpwv0QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyGTFXSu0tNLlsMMOa/d3/uhHP0rm3//+96PZRx99FM1OP/305LlbbLFFerACbrrppnY/EzqbESNGRLPU2q4QQjjyyCOj2dixYwvPlLJmzZpoNnPmzLK8E1py/vnnR7Mdd9wxmk2ePDmaVeN/n3v06BHNDjrooGhWV1eXPPeNN94oPFMt8iUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZrLhrhWOPPbYs57700kvRrKUVd6k1drvvvns0+853vtPiXEW8+eab0ezpp58uyzuho9l0002T+RVXXBHNxowZE8169+5deKZyufLKKys9Ap3QHnvskcwPP/zwaPbggw9Gs0qssevSJf2dc7fddotmqTW4hx56aDQrlUrJd15wwQXJvLPxJRoAADIp0QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyGRPdCv079+/LOfOmTMnmq1cubLwudOmTYtmffv2LXxuyuLFiwtl0JlMmDAhmR9xxBHraZLyO+igg6LZlClT1uMkdCaXXHJJMl+7dm00O/vss9t7nDYZMWJEMk/ttS7qz3/+czK/88472/2dHZkv0QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyGTFXQVNnDgxmm222WbJZ3fddddoNnDgwGhWKpVaHqyAxx9/vCznQkczfPjwaHbRRRetx0kqa8iQIdHsyCOPjGazZs0qxzjUkMGDB0ezYcOGJZ+94oorotn8+fMLz1QO++23XzJvbm6OZj169IhmG2ywQTRbsWJF8p2rV69O5p2NL9EAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMhkxV0rPPLII8l87Nixhc7t3r17NBs3blyhM8vpF7/4RTSbMmXKepwEqlfXrvF/rHbpUp7vFs8//3wyv/LKK6PZsmXLotlll10Wzfr27Zt8Z2qN1qBBg5LPQsphhx0WzTbccMPks88991x7j9Oi7bffPpqlfu089NBDk+eedtpp0eziiy+OZr169Ypml156afKdfJwv0QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJnuiW+FXv/pVMv/iF78YzVL7Icu1MzZ17rp165LPNjY2RrOf//zn0Wzt2rUtDwadwLx586LZN77xjeSzhx9+eDS79tpro9ljjz2WPPfvf/97NOvfv380W7NmTfLclHfffTeazZ49u/C5MGnSpGhWV1eXfHa77baLZnvuuWc022STTaLZ5MmTk+9M3evm5uZCz4UQwpgxY6JZfX19NPvhD38YzW6//fbkO/k4X6IBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJCprlQqlYo8uGrVqtDQ0NDe89SciRMnRrPRo0dHs3/+539Ontu7d+9ollrx09J/3KlVPdddd13yWVrW1NSU/M+u0qrxXvfp0yeZb7bZZtHs+eefj2adaS1jt27dotnUqVOj2RlnnFH4nS+++GI0Gzx4cOFzq5F7vX4dffTR0ayllbSpXx9T/0xIrXvs3r178p2PPvpoNDvqqKOi2auvvpo897e//W00Gzp0aDTbe++9o9nLL7+cfGdn0pp77Us0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJiUaAAAyda30ALXulltuKZRddtllyXMXLFgQzTbeeONo9tFHHyXPbWpqSuZQDptsskk0u/POO5PPfvazn41ms2fPjma33XZb8tzU/aw2/fv3T+annHJKNCu6xu6tt95K5uedd16hc6Eld9xxRzSbMWNG8tmxY8dGs0GDBkWzVatWRbPUKtsQQvjd736XzGO++93vJvMDDjggmk2ZMiWaWWPXfnyJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyKREAwBAJivuqtRWW22VzDfYYINC577xxhvJPLUSDMrlnnvuiWZ77rln4XMffvjhaHbXXXcVPrdc+vbtG8222WabaPbrX/86ee7AgQMLzZNaifmd73wn+ewNN9xQ6J3QktWrV0ezE044Iflsr169olm3bt2i2QcffBDNmpubk+8satKkSYWfTa3Bpf34Eg0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZLInukoNHjw4mXft6j86aserr74azdqyJzq153jjjTdOPttSXkRq13MIIdx+++3RbMCAAe09TgghhHXr1kWzn/3sZ9HMHmg6otSO6VRWLkOHDo1mLe13f/DBB6NZakc+7ceXaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZLInrYK23HLLaHbssceux0mgsubNmxfNDj/88MLnXnLJJYWyWvPuu+9GsxkzZkSzb3/72+UYB/gv559/fjTr2bNn8tm77rormn344YeFZ6L1fIkGAIBMSjQAAGRSogEAIJMSDQAAmZRoAADIpEQDAEAmK+4qaP/9949mu+yyS1neuXjx4rKcC21x6aWXRrPPfe5zyWc///nPt/M01Sm1surGG29MPnvRRRdFs7/85S+FZwJatvHGG0ezcePGRbMVK1Ykz73yyisLz0T78CUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMhkT3Qnc+edd1Z6BMiS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Pn2S76yrq4tmBStYi1LvbG5ujmYt7WRubGyMZqk90T179kye+9FHH0WzUaNGRbPUv5e2as299iUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZulZ6gI4gtV4lhBD22WefaJZaX/ODH/wgmnW0FXdf+MIXotmUKVOSz+60007RbIMNNohm7733XvLcGTNmJHNY31pa85S6K6n/vl999dXJc6+88spoNn78+GiWWnd14IEHJt/5xBNPJHMoKrU69rvf/W7y2Q8//DCaDR48OJq1tMauqNQdmzNnTvLZa665JpqlVv2l1sKtWLEi+c5ly5Yl85j6+vpk3r9//2hWzjV2beVLNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMtWVUjvYElatWhUaGhrae56q9Ic//CGZp9btpLz99tvR7Nvf/nahM0MIoa6uLpoV/I87hBDCqaeeGs0+9alPRbMNN9yw8Dv//ve/R7Ptt98++ew777xT+L3l0tTUFHr37l3pMaI6070ulyFDhkSz888/P/nsYYcdFs2WLl0azd58883kuZ/5zGei2aJFi6LZjjvuGM0efPDB5DtbWg1aS9zr9atHjx7R7JZbbkk+26tXr2i2+eabR7Ptttsump100knJd95zzz3R7IMPPohmb7zxRvJcyqs199qXaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgU9dKD1AtBgwYEM0GDRpUlnd+4hOfiGYzZ84sfG659kSXS3NzczQ75ZRTolk17oGmc+jZs2c0S+2CnjBhQvLc1P3caqutotm7776bPHennXaKZosXL45mqT21//iP/5h8J5RL6r/vhx56aPLZrl3jtWf27NnRLPXnEqT2QIcQwquvvprM6bh8iQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYr7v7LUUcdFc0GDx68Hicpr7lz5ybzjz76KJr169cvmg0dOrToSOG1116LZrfddlvhc6FcpkyZEs0OO+ywaNbSislUnlq/9eUvfzl5bksr8IrMU43rMqElkydPjmYHHnhgNJs3b140e+utt9o0Ex2XL9EAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMjUqVbcjRkzJpr94Ac/KMs733vvvULvfPLJJwu/s0uX+O+N7r///uSza9eujWYTJkyIZm1ZRbd06dLCz0K53HDDDdEstRIztfqtpVVzbVljVw6ptZZW3NERbbfddoWeu/jii6PZmjVrio5DB+dLNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMnWqFXdDhw6NZj169Ch8bmqN3ZQpU6LZT3/608LvrITUWq+U1N+fEEK46KKLCp0LbZFa2RhCCOPHj49mqfVuixYtimYtrdJMrbgrlyFDhkSz1L9PK+7oTEaOHBnN/vSnPyWfbW5ubu9xqBK+RAMAQCYlGgAAMinRAACQSYkGAIBMSjQAAGRSogEAIJMSDQAAmWpqT/Thhx+ezKdOnVqW9z700EPRrKPtgj7wwAOj2b777lvozNTfnxBa3rEJ5XD77bcn89Qe5CeffDKanXrqqdGspbtQCfvss080q6uri2ZXX311OcaBspo2bVo0GzZsWDT75je/WSgLIYR33nknms2YMSOa3Xzzzclzn3766Wi2du3a5LO0D1+iAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMinRAACQqaZW3P3yl79M5j169Ch07rPPPpvMjzvuuELnVqPU2qrevXsXOvOCCy4oOg6UTWqFXQgh/OY3v4lmJ554YjR78803C89UCUOGDIlmqb9HixcvLsc4UFbNzc3RbMKECdFs9OjR0ezTn/508p1f/vKXo9kpp5xSKAshhHvuuSea3XfffdFs7ty50WzhwoXJd/JxvkQDAEAmJRoAADIp0QAAkEmJBgCATEo0AABkUqIBACBTXamlPU8Rq1atCg0NDe09T5s0NTUl8169ekWzRYsWRbMxY8Ykz122bFl6sCoyYsSIZH7vvfdGs9Tfv5T99tsvmc+ZM6fQuR1RU1NT4VWB60M13mvKa8GCBYWeGzZsWDtP0nG516RstdVW0ewzn/lMNDvyyCOT544bNy6apVb6ptb8zZ49O/nOSy+9NJo988wzyWc7mtbca1+iAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMinRAACQSYkGAIBMXSs9QHsaO3ZsMj/00EOj2SWXXBLNli9fXnimavOd73wnmdfX1xc6909/+lM060x7oKEaDRkypFC2ePHicowDncrLL79cKGtpZ/Pmm28ezVK/1qf2Sx9zzDHJd06YMCGanX766dFsxowZyXM7Kl+iAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMinRAACQqaZW3M2fP79Nea047bTTotnnP//55LOlUqnQO+fNm1foOaD8zj///GjWo0ePaDZ9+vRyjAO0g2XLlkWzVA/4yU9+Es3OPvvs5DsnT54czS6++OJo9thjjyXPfeaZZ5J5tfIlGgAAMinRAACQSYkGAIBMSjQAAGRSogEAIJMSDQAAmWpqxR3/afjw4WU59/e//300S63QAspryJAhyXz8+PHR7De/+U00mz17dtGRgCrV2NgYzU466aTks+PGjYtmm222WTTr06dPy4N1QL5EAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxV3VWrDDTdM5gcffHA0O+KII6JZqVQqPNMPf/jDaPbBBx8UPhdoWc+ePaPZ7bffnny2rq4umi1evLjwTEDHs+mmm0azE044Iflsv379otlDDz0UzebMmdPyYB2QL9EAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCZ7oqvUTjvtlMxvu+22srz38ssvj2ZPPPFEWd4JtGzChAnRbIcddkg+u3z58mg2Y8aMwjNBUbvvvnsy9+tN24wcOTKapf5ZcvLJJyfPffLJJ6PZeeed1/JgNcaXaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZLLiroJ22223aPbv//7vZXnn66+/nsynT58ezdasWdPe4wD/P/369Ytm119/fTQrlUrJc0844YRo9sorr7Q8GLSzzTffPJn/7W9/i2apFW0LFy4sPFO16dGjRzLff//9o9ns2bOjWeqfF++++27ynYcddlg0W7ZsWfLZWuRLNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYlGgAAMllxV2bdunWLZlOnTo1mW2yxReF31tXVRbPx48cnn12+fHnh9wJtU3SN3aJFi5LnptZdQSXcddddyXy//fYr9Oyjjz6aPPfBBx+MZo8//njy2aJGjRoVzT796U9Hsy233DJ57p577hnN3n///WiW+vt38cUXJ9/ZGdfYpfgSDQAAmZRoAADIpEQDAEAmJRoAADIp0QAAkEmJBgCATEo0AABksie6zD75yU9Gs0MPPXQ9TvKfTjnllGS+du3aaDZ9+vRo9pe//KXwTNBZHHDAAcl8zJgx0axLl/g3jwsuuKDwTFCNrrjiimi2++67R7PDDz88ee4RRxwRzVK72Nsi9Wc3tOWdd999dzQ755xzotmTTz5Z+J18nC/RAACQSYkGAIBMSjQAAGRSogEAIJMSDQAAmZRoAADIZMVdmb3++uvR7LHHHotmw4cPL8c4YeLEicn8ww8/jGZ//OMfo5kVd/CfhgwZEs1+9atfJZ9Nrbt64403otmDDz7Y8mDQgfz1r3+NZmPHjo1mffr0SZ77rW99K5qNGzcumm233XbJc1Puv//+aPbEE09Es1mzZiXPfeqpp6LZRx991PJgtJkv0QAAkEmJBgCATEo0AABkUqIBACCTEg0AAJmUaAAAyGTFXZm9/fbb0ez888+PZt/73veS544YMaLwTClf+cpXotnNN99clndCLRk5cmQ022yzzZLPrlu3LpqdcMIJ0eyVV15peTCoEe+++26hLIQQTjvttEIZ/F98iQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQCYr7irorrvuKpQB1Wv8+PHRLLXCLoQQFi1aFM1mz55ddCQAysCXaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkz3RAO3owAMPrPQIAKwHvkQDAEAmJRoAADIp0QAAkEmJBgCATEo0AABkKlyiS6VSe84BnUK135tqnw+qUbXfm2qfD6pRa+5N4RLd3Nxc9FHotKr93lT7fFCNqv3eVPt8UI1ac2/qSgV/i7pu3brQ2NgY6uvrQ11dXZEjoNMolUqhubk5DBgwIHTpUr0/ReVeQ+u511B7cu514RINAACdVfX+1hkAAKqUEg0AAJmUaAAAyKREAwBAJiUaAAAyKdEAAJBJiQYAgExKNAAAZFKiAQAgkxINAACZlGgAAMikRAMAQKb/DxRVbtkCyYGXAAAAAElFTkSuQmCC\n",
      "text/plain": [
       "<Figure size 900x900 with 9 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "plots(x_val[:9].reshape(-1, 28, 28), num_preds[:9])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## A neural network\n",
    "\n",
    "A neural network consists of several layers, connected by matrix multiplications. Layers between the input and output layer are called hidden layers. The activations in these layers are passed through a non-linear activation function.\n",
    "\n",
    "Neural networks can approximate any non-linear function: http://neuralnetworksanddeeplearning.com/chap4.html"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "metadata": {},
   "outputs": [],
   "source": [
    "neural_net = Sequential([\n",
    "    Dense(512, input_shape=(784,), activation='relu'),\n",
    "    Dense(10, activation='softmax'),\n",
    "])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {},
   "outputs": [],
   "source": [
    "neural_net.compile('adam', 'categorical_crossentropy', metrics=['accuracy'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Model: \"sequential_1\"\n",
      "_________________________________________________________________\n",
      " Layer (type)                Output Shape              Param #   \n",
      "=================================================================\n",
      " dense_1 (Dense)             (None, 512)               401920    \n",
      "                                                                 \n",
      " dense_2 (Dense)             (None, 10)                5130      \n",
      "                                                                 \n",
      "=================================================================\n",
      "Total params: 407,050\n",
      "Trainable params: 407,050\n",
      "Non-trainable params: 0\n",
      "_________________________________________________________________\n"
     ]
    }
   ],
   "source": [
    "neural_net.summary()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1/10\n",
      "94/94 [==============================] - 1s 7ms/step - loss: 0.4618 - accuracy: 0.8715 - val_loss: 0.2334 - val_accuracy: 0.9350\n",
      "Epoch 2/10\n",
      "94/94 [==============================] - 1s 7ms/step - loss: 0.1983 - accuracy: 0.9450 - val_loss: 0.1732 - val_accuracy: 0.9509\n",
      "Epoch 3/10\n",
      "94/94 [==============================] - 1s 7ms/step - loss: 0.1421 - accuracy: 0.9604 - val_loss: 0.1363 - val_accuracy: 0.9606\n",
      "Epoch 4/10\n",
      "94/94 [==============================] - 1s 6ms/step - loss: 0.1099 - accuracy: 0.9700 - val_loss: 0.1165 - val_accuracy: 0.9672\n",
      "Epoch 5/10\n",
      "94/94 [==============================] - 1s 6ms/step - loss: 0.0876 - accuracy: 0.9762 - val_loss: 0.1028 - val_accuracy: 0.9700\n",
      "Epoch 6/10\n",
      "94/94 [==============================] - 1s 6ms/step - loss: 0.0717 - accuracy: 0.9808 - val_loss: 0.0958 - val_accuracy: 0.9712\n",
      "Epoch 7/10\n",
      "94/94 [==============================] - 1s 6ms/step - loss: 0.0597 - accuracy: 0.9841 - val_loss: 0.0874 - val_accuracy: 0.9759\n",
      "Epoch 8/10\n",
      "94/94 [==============================] - 1s 6ms/step - loss: 0.0495 - accuracy: 0.9873 - val_loss: 0.0834 - val_accuracy: 0.9757\n",
      "Epoch 9/10\n",
      "94/94 [==============================] - 1s 7ms/step - loss: 0.0423 - accuracy: 0.9891 - val_loss: 0.0770 - val_accuracy: 0.9774\n",
      "Epoch 10/10\n",
      "94/94 [==============================] - 1s 6ms/step - loss: 0.0355 - accuracy: 0.9914 - val_loss: 0.0791 - val_accuracy: 0.9769\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "<keras.callbacks.History at 0x18e4788e0>"
      ]
     },
     "execution_count": 34,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "neural_net.fit(x_trn, yoh_trn, batch_size=512, epochs=10, validation_data=(x_val, yoh_val))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Deep neural networks"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "metadata": {},
   "outputs": [],
   "source": [
    "deep_net = Sequential([\n",
    "    Dense(512, input_shape=(784,), activation='relu'),\n",
    "    Dropout(0.3),\n",
    "    Dense(256, activation='relu'),\n",
    "    Dropout(0.3),\n",
    "    Dense(256, activation='relu'),\n",
    "    Dropout(0.3),\n",
    "    Dense(10, activation='softmax'),\n",
    "])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "metadata": {},
   "outputs": [],
   "source": [
    "deep_net.compile('adam', 'categorical_crossentropy', metrics=['accuracy'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 37,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Model: \"sequential_2\"\n",
      "_________________________________________________________________\n",
      " Layer (type)                Output Shape              Param #   \n",
      "=================================================================\n",
      " dense_3 (Dense)             (None, 512)               401920    \n",
      "                                                                 \n",
      " dropout (Dropout)           (None, 512)               0         \n",
      "                                                                 \n",
      " dense_4 (Dense)             (None, 256)               131328    \n",
      "                                                                 \n",
      " dropout_1 (Dropout)         (None, 256)               0         \n",
      "                                                                 \n",
      " dense_5 (Dense)             (None, 256)               65792     \n",
      "                                                                 \n",
      " dropout_2 (Dropout)         (None, 256)               0         \n",
      "                                                                 \n",
      " dense_6 (Dense)             (None, 10)                2570      \n",
      "                                                                 \n",
      "=================================================================\n",
      "Total params: 601,610\n",
      "Trainable params: 601,610\n",
      "Non-trainable params: 0\n",
      "_________________________________________________________________\n"
     ]
    }
   ],
   "source": [
    "deep_net.summary()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 38,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1/10\n",
      "94/94 [==============================] - 1s 12ms/step - loss: 0.5593 - accuracy: 0.8275 - val_loss: 0.1793 - val_accuracy: 0.9469\n",
      "Epoch 2/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.1948 - accuracy: 0.9421 - val_loss: 0.1226 - val_accuracy: 0.9626\n",
      "Epoch 3/10\n",
      "94/94 [==============================] - 1s 12ms/step - loss: 0.1374 - accuracy: 0.9586 - val_loss: 0.1029 - val_accuracy: 0.9688\n",
      "Epoch 4/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.1038 - accuracy: 0.9691 - val_loss: 0.0904 - val_accuracy: 0.9719\n",
      "Epoch 5/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0854 - accuracy: 0.9746 - val_loss: 0.0788 - val_accuracy: 0.9764\n",
      "Epoch 6/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0744 - accuracy: 0.9774 - val_loss: 0.0786 - val_accuracy: 0.9766\n",
      "Epoch 7/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0653 - accuracy: 0.9804 - val_loss: 0.0761 - val_accuracy: 0.9772\n",
      "Epoch 8/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0512 - accuracy: 0.9839 - val_loss: 0.0743 - val_accuracy: 0.9782\n",
      "Epoch 9/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0503 - accuracy: 0.9836 - val_loss: 0.0744 - val_accuracy: 0.9797\n",
      "Epoch 10/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0458 - accuracy: 0.9854 - val_loss: 0.0756 - val_accuracy: 0.9801\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "<keras.callbacks.History at 0x18ec80910>"
      ]
     },
     "execution_count": 38,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "deep_net.fit(x_trn, yoh_trn, batch_size=512, epochs=10, validation_data=(x_val, yoh_val))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0316 - accuracy: 0.9900 - val_loss: 0.0670 - val_accuracy: 0.9825\n",
      "Epoch 2/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0255 - accuracy: 0.9922 - val_loss: 0.0656 - val_accuracy: 0.9834\n",
      "Epoch 3/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0231 - accuracy: 0.9926 - val_loss: 0.0660 - val_accuracy: 0.9829\n",
      "Epoch 4/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0224 - accuracy: 0.9928 - val_loss: 0.0651 - val_accuracy: 0.9836\n",
      "Epoch 5/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0212 - accuracy: 0.9933 - val_loss: 0.0664 - val_accuracy: 0.9837\n",
      "Epoch 6/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0194 - accuracy: 0.9941 - val_loss: 0.0672 - val_accuracy: 0.9839\n",
      "Epoch 7/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0182 - accuracy: 0.9945 - val_loss: 0.0670 - val_accuracy: 0.9835\n",
      "Epoch 8/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0177 - accuracy: 0.9944 - val_loss: 0.0677 - val_accuracy: 0.9833\n",
      "Epoch 9/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0170 - accuracy: 0.9948 - val_loss: 0.0671 - val_accuracy: 0.9838\n",
      "Epoch 10/10\n",
      "94/94 [==============================] - 1s 11ms/step - loss: 0.0163 - accuracy: 0.9950 - val_loss: 0.0671 - val_accuracy: 0.9838\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "<keras.callbacks.History at 0x18ed60a60>"
      ]
     },
     "execution_count": 39,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "deep_net.optimizer.lr=1e-4\n",
    "deep_net.fit(x_trn, yoh_trn, batch_size=512, epochs=10, validation_data=(x_val, yoh_val))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Convolutions\n",
    "\n",
    "To take advantage of the spatial information in images we can use convolutions rather than fully connected layers.\n",
    "\n",
    "http://setosa.io/ev/image-kernels/"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "metadata": {},
   "outputs": [],
   "source": [
    "conv_net = Sequential([\n",
    "    Conv2D(32, kernel_size=5, strides=2, activation='relu', padding='same', input_shape=(28, 28, 1)),\n",
    "    Conv2D(64, kernel_size=3, strides=2, activation='relu', padding='same'),\n",
    "    Conv2D(128, kernel_size=3, strides=2, activation='relu', padding='same'),\n",
    "    Conv2D(10, kernel_size=3, strides=2, padding='same'),\n",
    "    GlobalAveragePooling2D(),\n",
    "    Activation('softmax')\n",
    "])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Model: \"sequential_3\"\n",
      "_________________________________________________________________\n",
      " Layer (type)                Output Shape              Param #   \n",
      "=================================================================\n",
      " conv2d (Conv2D)             (None, 14, 14, 32)        832       \n",
      "                                                                 \n",
      " conv2d_1 (Conv2D)           (None, 7, 7, 64)          18496     \n",
      "                                                                 \n",
      " conv2d_2 (Conv2D)           (None, 4, 4, 128)         73856     \n",
      "                                                                 \n",
      " conv2d_3 (Conv2D)           (None, 2, 2, 10)          11530     \n",
      "                                                                 \n",
      " global_average_pooling2d (G  (None, 10)               0         \n",
      " lobalAveragePooling2D)                                          \n",
      "                                                                 \n",
      " activation (Activation)     (None, 10)                0         \n",
      "                                                                 \n",
      "=================================================================\n",
      "Total params: 104,714\n",
      "Trainable params: 104,714\n",
      "Non-trainable params: 0\n",
      "_________________________________________________________________\n"
     ]
    }
   ],
   "source": [
    "conv_net.summary()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 42,
   "metadata": {},
   "outputs": [],
   "source": [
    "conv_net.compile('adam', 'categorical_crossentropy', metrics=['accuracy'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1/20\n",
      "94/94 [==============================] - 5s 46ms/step - loss: 0.7986 - accuracy: 0.7574 - val_loss: 0.3172 - val_accuracy: 0.9059\n",
      "Epoch 2/20\n",
      "94/94 [==============================] - 4s 44ms/step - loss: 0.2577 - accuracy: 0.9236 - val_loss: 0.1987 - val_accuracy: 0.9430\n",
      "Epoch 3/20\n",
      "94/94 [==============================] - 4s 43ms/step - loss: 0.1730 - accuracy: 0.9486 - val_loss: 0.1392 - val_accuracy: 0.9598\n",
      "Epoch 4/20\n",
      "94/94 [==============================] - 4s 43ms/step - loss: 0.1245 - accuracy: 0.9625 - val_loss: 0.1126 - val_accuracy: 0.9682\n",
      "Epoch 5/20\n",
      "94/94 [==============================] - 4s 44ms/step - loss: 0.1013 - accuracy: 0.9691 - val_loss: 0.0932 - val_accuracy: 0.9741\n",
      "Epoch 6/20\n",
      "94/94 [==============================] - 4s 43ms/step - loss: 0.0836 - accuracy: 0.9743 - val_loss: 0.0908 - val_accuracy: 0.9747\n",
      "Epoch 7/20\n",
      "94/94 [==============================] - 4s 43ms/step - loss: 0.0705 - accuracy: 0.9784 - val_loss: 0.0763 - val_accuracy: 0.9771\n",
      "Epoch 8/20\n",
      "94/94 [==============================] - 4s 44ms/step - loss: 0.0620 - accuracy: 0.9814 - val_loss: 0.0705 - val_accuracy: 0.9796\n",
      "Epoch 9/20\n",
      "94/94 [==============================] - 4s 46ms/step - loss: 0.0568 - accuracy: 0.9826 - val_loss: 0.0716 - val_accuracy: 0.9790\n",
      "Epoch 10/20\n",
      "94/94 [==============================] - 4s 44ms/step - loss: 0.0502 - accuracy: 0.9847 - val_loss: 0.0719 - val_accuracy: 0.9780\n",
      "Epoch 11/20\n",
      "94/94 [==============================] - 4s 43ms/step - loss: 0.0494 - accuracy: 0.9841 - val_loss: 0.0645 - val_accuracy: 0.9812\n",
      "Epoch 12/20\n",
      "94/94 [==============================] - 4s 44ms/step - loss: 0.0423 - accuracy: 0.9870 - val_loss: 0.0644 - val_accuracy: 0.9832\n",
      "Epoch 13/20\n",
      "94/94 [==============================] - 4s 44ms/step - loss: 0.0393 - accuracy: 0.9884 - val_loss: 0.0608 - val_accuracy: 0.9815\n",
      "Epoch 14/20\n",
      "94/94 [==============================] - 4s 44ms/step - loss: 0.0350 - accuracy: 0.9889 - val_loss: 0.0564 - val_accuracy: 0.9837\n",
      "Epoch 15/20\n",
      "94/94 [==============================] - 4s 45ms/step - loss: 0.0308 - accuracy: 0.9906 - val_loss: 0.0610 - val_accuracy: 0.9826\n",
      "Epoch 16/20\n",
      "51/94 [===============>..............] - ETA: 1s - loss: 0.0277 - accuracy: 0.9917"
     ]
    }
   ],
   "source": [
    "conv_net.fit(x_trn.reshape(-1, 28, 28, 1), yoh_trn, batch_size=512, epochs=20, \n",
    "             validation_data=(x_val.reshape(-1, 28, 28, 1), yoh_val))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## End"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "keras",
   "language": "python",
   "name": "keras"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.6"
  },
  "toc": {
   "nav_menu": {},
   "number_sections": true,
   "sideBar": false,
   "skip_h1_title": true,
   "toc_cell": false,
   "toc_position": {},
   "toc_section_display": "block",
   "toc_window_display": false
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
